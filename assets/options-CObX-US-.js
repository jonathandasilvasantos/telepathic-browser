import{r as c,j as e,c as q,R as J}from"./client-CtI-t4g5.js";import{c as N,P as f,a as Q,d as W,e as X}from"./storage-CWpUKz6p.js";const Y=Object.keys(f);function ee({isOpen:o,onClose:d,onSave:v,editProvider:x,editApiKey:S,editBaseUrl:k,configuredProviders:y,editModelId:I,onSaveCustomModel:U}){const g=!!x,w=Y.filter(s=>!y.includes(s)),[u,_]=c.useState(x||w[0]||"zhipu"),[b,m]=c.useState(S||""),[j,B]=c.useState(!1),[n,i]=c.useState(k||""),[a,l]=c.useState(""),[p,r]=c.useState(!1),[E,M]=c.useState(I||"");c.useEffect(()=>{if(o){const s=x||w[0]||"zhipu";_(s),m(S||""),B(!1),M(I||""),D(s,k||"")}},[o,x]);function D(s,h){var O;const K=L(s);if(!h){i(((O=K[0])==null?void 0:O.url)||""),r(!1),l("");return}const R=K.find(Z=>Z.url===h);R?(i(R.url),r(!1),l("")):(i("__custom__"),r(!0),l(h))}function L(s){const h=N[s];return h&&h.length>0?h:s!=="custom"?[{label:`${f[s].name} (Default)`,url:f[s].baseUrl}]:[]}const H=s=>{_(s),m(""),M(""),D(s,"")},$=s=>{s==="__custom__"?(i("__custom__"),r(!0),l("")):(i(s),r(!1),l(""))},F=()=>{var R;if(!b.trim())return;const s=p?a.trim():n,h=((R=f[u])==null?void 0:R.baseUrl)||"",K=s===h?"":s;v(u,b.trim(),K),u==="custom"&&U&&U(E.trim()),d()};if(!o)return null;const G=L(u),C=f[u];return e.jsx("div",{style:te,onClick:d,children:e.jsxs("div",{style:ne,onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{style:se,children:[e.jsx("h3",{style:oe,children:g?"Edit API Key":"Add API Key"}),e.jsx("button",{style:le,onClick:d,"aria-label":"Close",children:"Ã—"})]}),e.jsxs("div",{style:ie,children:[e.jsxs("div",{style:A,children:[e.jsx("label",{style:z,children:"Provider"}),g?e.jsx("div",{style:ce,children:C.name}):e.jsx("select",{style:V,value:u,onChange:s=>H(s.target.value),children:w.map(s=>e.jsx("option",{value:s,children:f[s].name},s))})]}),e.jsxs("div",{style:A,children:[e.jsx("label",{style:z,children:"API Key"}),e.jsxs("div",{style:ae,children:[e.jsx("input",{type:j?"text":"password",style:P,value:b,onChange:s=>m(s.target.value),placeholder:`Enter ${C.name} API key`,autoFocus:!0}),e.jsx("button",{style:de,onClick:()=>B(!j),children:j?"Hide":"Show"})]}),C.apiKeyUrl&&e.jsxs("p",{style:T,children:["Get key at"," ",e.jsx("a",{href:`https://${C.apiKeyUrl}`,target:"_blank",rel:"noopener noreferrer",style:pe,children:C.apiKeyUrl})]})]}),u!=="custom"&&e.jsxs("div",{style:A,children:[e.jsx("label",{style:z,children:"Base URL"}),e.jsxs("select",{style:V,value:p?"__custom__":n,onChange:s=>$(s.target.value),children:[G.map(s=>e.jsx("option",{value:s.url,children:s.label},s.url)),e.jsx("option",{value:"__custom__",children:"Custom..."})]}),p&&e.jsx("input",{type:"text",style:{...P,marginTop:"8px"},value:a,onChange:s=>l(s.target.value),placeholder:"https://api.example.com/v1"})]}),u==="custom"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:A,children:[e.jsx("label",{style:z,children:"Base URL"}),e.jsx("input",{type:"text",style:P,value:p?a:n||"",onChange:s=>{r(!0),l(s.target.value)},placeholder:"https://api.example.com/v1"}),e.jsx("p",{style:T,children:"OpenAI-compatible API base URL (without /chat/completions)"})]}),e.jsxs("div",{style:A,children:[e.jsx("label",{style:z,children:"Model ID"}),e.jsx("input",{type:"text",style:P,value:E,onChange:s=>M(s.target.value),placeholder:"model-name"}),e.jsx("p",{style:T,children:"The model identifier to use with this endpoint"})]})]})]}),e.jsxs("div",{style:re,children:[e.jsx("button",{style:xe,onClick:d,children:"Cancel"}),e.jsx("button",{style:{...ue,opacity:b.trim()?1:.5,cursor:b.trim()?"pointer":"not-allowed"},onClick:F,disabled:!b.trim(),children:"Save"})]})]})})}const te={position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},ne={background:"#1e293b",borderRadius:"12px",width:"480px",maxWidth:"90vw",maxHeight:"90vh",overflow:"auto",boxShadow:"0 20px 60px rgba(0,0,0,0.5)"},se={display:"flex",alignItems:"center",justifyContent:"space-between",padding:"20px 24px 0"},oe={fontSize:"18px",fontWeight:600,color:"#e2e8f0",margin:0},le={background:"none",border:"none",color:"#94a3b8",fontSize:"24px",cursor:"pointer",padding:"0 4px",lineHeight:1},ie={padding:"20px 24px"},re={display:"flex",justifyContent:"flex-end",gap:"12px",padding:"0 24px 20px"},A={marginBottom:"16px"},z={display:"block",fontSize:"13px",fontWeight:500,marginBottom:"6px",color:"#94a3b8"},ae={display:"flex",gap:"8px"},P={flex:1,padding:"10px 12px",background:"#0f172a",border:"1px solid #334155",borderRadius:"8px",color:"#e2e8f0",fontSize:"14px",outline:"none",width:"100%"},V={width:"100%",padding:"10px 12px",background:"#0f172a",border:"1px solid #334155",borderRadius:"8px",color:"#e2e8f0",fontSize:"14px",cursor:"pointer",outline:"none"},de={padding:"10px 14px",background:"#334155",border:"none",borderRadius:"8px",color:"#e2e8f0",fontSize:"13px",cursor:"pointer",flexShrink:0},ce={padding:"10px 12px",background:"#0f172a",border:"1px solid #334155",borderRadius:"8px",color:"#64748b",fontSize:"14px"},T={fontSize:"12px",color:"#64748b",marginTop:"6px"},pe={color:"#3b82f6",textDecoration:"none"},xe={padding:"10px 20px",background:"#334155",border:"none",borderRadius:"8px",color:"#e2e8f0",fontSize:"14px",cursor:"pointer"},ue={padding:"10px 20px",background:"#3b82f6",border:"none",borderRadius:"8px",color:"white",fontSize:"14px",fontWeight:500,cursor:"pointer"},he=Object.keys(f);function ge(){var B;const[o,d]=c.useState(null),[v,x]=c.useState(!1),[S,k]=c.useState(!1),[y,I]=c.useState();c.useEffect(()=>{Q().then(d)},[]);const U=async()=>{o&&(await X(o),x(!0),setTimeout(()=>x(!1),2e3),chrome.runtime.sendMessage({type:"UPDATE_PROVIDER",payload:{provider:o.provider}}))},g=(n,i)=>{d(a=>a?{...a,[n]:i}:null)},w=()=>{I(void 0),k(!0)},u=n=>{I(n),k(!0)},_=(n,i,a)=>{if(!o)return;const l={...o.apiKeys,[n]:i},p={...o.baseUrls};a?p[n]=a:delete p[n],d(r=>r?{...r,apiKeys:l,baseUrls:p}:null)},b=n=>{if(!o)return;const i={...o.apiKeys};delete i[n];const a={...o.baseUrls};delete a[n];let l=o.defaultModel;W(n,o).some(r=>r.id===l)&&(l=""),d(r=>r?{...r,apiKeys:i,baseUrls:a,defaultModel:l}:null)};if(!o)return e.jsx("div",{style:t.container,children:e.jsx("p",{children:"Loading..."})});const m=he.filter(n=>!!o.apiKeys[n]),j=[];for(const n of m){const i=W(n,o);i.length>0&&j.push({provider:n,providerName:f[n].name,models:i})}return e.jsxs("div",{style:t.container,children:[e.jsxs("header",{style:t.header,children:[e.jsxs("h1",{style:t.title,children:[e.jsx(ye,{}),"Telepathic Browser"]}),e.jsx("p",{style:t.subtitle,children:"Configure your Telepathic Browser settings"})]}),e.jsxs("section",{style:t.section,children:[e.jsxs("div",{style:t.sectionHeader,children:[e.jsxs("h2",{style:t.sectionTitle,children:[e.jsx("span",{children:"ðŸ”‘"}),"API Keys"]}),e.jsx("button",{style:t.addBtn,onClick:w,children:"+ Add API Key"})]}),m.length===0?e.jsxs("div",{style:t.emptyState,children:["No API keys configured yet. Click ",e.jsx("strong",{children:"Add API Key"})," to get started."]}):e.jsxs("table",{style:t.table,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:t.th,children:"Provider"}),e.jsx("th",{style:t.th,children:"API Key"}),e.jsx("th",{style:t.th,children:"Base URL"}),e.jsx("th",{style:{...t.th,textAlign:"right"},children:"Actions"})]})}),e.jsx("tbody",{children:m.map(n=>{var r;const i=o.apiKeys[n]||"",a=i.length>4?"â€¢â€¢â€¢â€¢"+i.slice(-4):"â€¢â€¢â€¢â€¢",l=((r=o.baseUrls)==null?void 0:r[n])||"",p=fe(n,l);return e.jsxs("tr",{style:t.tr,children:[e.jsx("td",{style:t.td,children:e.jsx("span",{style:t.providerName,children:f[n].name})}),e.jsx("td",{style:t.td,children:e.jsx("code",{style:t.maskedKey,children:a})}),e.jsx("td",{style:t.td,children:e.jsx("span",{style:t.baseUrlLabel,children:p})}),e.jsxs("td",{style:{...t.td,textAlign:"right"},children:[e.jsx("button",{style:t.actionBtn,onClick:()=>u(n),children:"Edit"}),e.jsx("button",{style:{...t.actionBtn,...t.deleteBtn},onClick:()=>b(n),children:"Delete"})]})]},n)})})]})]}),e.jsxs("section",{style:t.section,children:[e.jsxs("h2",{style:t.sectionTitle,children:[e.jsx("span",{children:"âš™ï¸"}),"Default Settings"]}),e.jsxs("div",{style:t.field,children:[e.jsx("label",{style:t.label,children:"Default Model"}),e.jsxs("select",{style:t.select,value:o.defaultModel,onChange:n=>g("defaultModel",n.target.value),children:[j.length===0&&e.jsx("option",{value:"",disabled:!0,children:"No providers configured"}),j.map(({provider:n,providerName:i,models:a})=>e.jsx("optgroup",{label:i,children:a.map(l=>e.jsxs("option",{value:l.id,children:[l.name,l.supportsVision?" (Vision)":""," -"," ",(l.contextLength/1e3).toFixed(0),"K context"]},`${n}:${l.id}`))},n))]})]}),e.jsxs("div",{style:t.field,children:[e.jsx("label",{style:t.label,children:"Permission Level"}),e.jsxs("select",{style:t.select,value:o.permissionLevel,onChange:n=>g("permissionLevel",n.target.value),children:[e.jsx("option",{value:"ask",children:"Ask before each action"}),e.jsx("option",{value:"allow_site",children:"Allow actions per site"}),e.jsx("option",{value:"allow_all",children:"Allow all actions (not recommended)"})]}),e.jsx("p",{style:t.hint,children:"Controls when Telepathic Browser asks for permission to interact with pages"})]}),e.jsxs("div",{style:t.field,children:[e.jsx("label",{style:t.label,children:"Language"}),e.jsxs("select",{style:t.select,value:o.language,onChange:n=>g("language",n.target.value),children:[e.jsx("option",{value:"en",children:"English"}),e.jsx("option",{value:"zh",children:"ä¸­æ–‡ (Chinese)"})]})]}),e.jsxs("div",{style:t.field,children:[e.jsx("label",{style:t.label,children:"Max Actions per Task"}),e.jsx("input",{type:"number",style:t.input,value:o.maxIterations||30,min:5,max:100,onChange:n=>g("maxIterations",Math.max(5,Math.min(100,parseInt(n.target.value)||30)))}),e.jsx("p",{style:t.hint,children:"Maximum number of actions (tool calls) per task before pausing. Range: 5-100, default: 30"})]}),e.jsxs("div",{style:t.field,children:[e.jsxs("label",{style:{...t.label,display:"flex",alignItems:"center",gap:"8px",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:o.enableNudgeSystem||!1,onChange:n=>g("enableNudgeSystem",n.target.checked),style:{width:"16px",height:"16px",cursor:"pointer"}}),"Enable loop detection (nudge system)"]}),e.jsx("p",{style:t.hint,children:"When enabled, the agent will be nudged to change approach if it gets stuck in a loop."})]})]}),e.jsxs("div",{children:[e.jsx("button",{style:t.button,onClick:U,children:"Save Settings"}),v&&e.jsx("span",{style:t.success,children:"âœ“ Settings saved!"})]}),e.jsxs("section",{style:{...t.section,marginTop:"32px",background:"transparent",padding:0},children:[e.jsxs("h2",{style:{...t.sectionTitle,color:"#64748b"},children:[e.jsx("span",{children:"â„¹ï¸"}),"About"]}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",lineHeight:1.6},children:"Telepathic Browser is an AI-powered browser automation extension. It supports multiple AI providers including OpenAI, Google Gemini, Anthropic, Zhipu AI, DeepSeek, and more. It can help you browse the web, fill out forms, analyze page content, and more."}),e.jsx("p",{style:{fontSize:"13px",color:"#475569",marginTop:"12px"},children:"Version 1.0.0"})]}),e.jsx(ee,{isOpen:S,onClose:()=>k(!1),onSave:_,editProvider:y,editApiKey:y?o.apiKeys[y]:void 0,editBaseUrl:y?(B=o.baseUrls)==null?void 0:B[y]:void 0,configuredProviders:m,editModelId:y==="custom"?o.customModelId:void 0,onSaveCustomModel:n=>g("customModelId",n)})]})}function fe(o,d){if(!d)return"Default";const v=N[o];if(v){const x=v.find(S=>S.url===d);if(x)return x.label}return d.length>35?d.slice(0,32)+"...":d}function ye(){return e.jsx("img",{src:"/icons/icon-48.png",width:"28",height:"28",alt:"Telepathic Browser",style:{borderRadius:"6px"}})}const t={container:{maxWidth:"700px",margin:"0 auto",padding:"40px 24px"},header:{marginBottom:"32px"},title:{fontSize:"28px",fontWeight:"600",marginBottom:"8px",display:"flex",alignItems:"center",gap:"12px"},subtitle:{color:"#94a3b8",fontSize:"14px"},section:{background:"#1e293b",borderRadius:"12px",padding:"24px",marginBottom:"24px"},sectionHeader:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"16px"},sectionTitle:{fontSize:"16px",fontWeight:"600",margin:0,display:"flex",alignItems:"center",gap:"8px"},addBtn:{padding:"8px 16px",background:"#3b82f6",border:"none",borderRadius:"8px",color:"white",fontSize:"13px",fontWeight:"500",cursor:"pointer"},emptyState:{textAlign:"center",padding:"32px 16px",color:"#64748b",fontSize:"14px"},table:{width:"100%",borderCollapse:"collapse"},th:{textAlign:"left",padding:"10px 12px",fontSize:"12px",fontWeight:"500",color:"#64748b",borderBottom:"1px solid #334155",textTransform:"uppercase",letterSpacing:"0.05em"},tr:{borderBottom:"1px solid #1e293b"},td:{padding:"12px",fontSize:"14px",color:"#e2e8f0",borderBottom:"1px solid #334155"},providerName:{fontWeight:"500"},maskedKey:{background:"#0f172a",padding:"3px 8px",borderRadius:"4px",fontSize:"13px",color:"#94a3b8",fontFamily:"monospace"},baseUrlLabel:{fontSize:"13px",color:"#94a3b8"},actionBtn:{padding:"5px 12px",background:"#334155",border:"none",borderRadius:"6px",color:"#e2e8f0",fontSize:"12px",cursor:"pointer",marginLeft:"6px"},deleteBtn:{color:"#f87171"},field:{marginBottom:"20px"},label:{display:"block",fontSize:"14px",fontWeight:"500",marginBottom:"8px",color:"#e2e8f0"},input:{width:"100%",padding:"12px",background:"#0f172a",border:"1px solid #334155",borderRadius:"8px",color:"#e2e8f0",fontSize:"14px",outline:"none"},select:{width:"100%",padding:"12px",background:"#0f172a",border:"1px solid #334155",borderRadius:"8px",color:"#e2e8f0",fontSize:"14px",cursor:"pointer",outline:"none"},hint:{fontSize:"12px",color:"#64748b",marginTop:"6px"},button:{padding:"12px 24px",background:"#3b82f6",border:"none",borderRadius:"8px",color:"white",fontSize:"14px",fontWeight:"500",cursor:"pointer",marginRight:"12px"},success:{display:"inline-block",marginLeft:"12px",color:"#22c55e",fontSize:"14px"}};q.createRoot(document.getElementById("root")).render(e.jsx(J.StrictMode,{children:e.jsx(ge,{})}));
